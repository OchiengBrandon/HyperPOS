<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt #{{ sale.invoice_number }}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* === THERMAL RECEIPT STYLING === */
        body {
            font-family: 'Courier New', 'Liberation Mono', 'DejaVu Sans Mono', Monaco, monospace;
            background-color: #f5f7fa;
            padding: 20px;
            line-height: 1.2;
            color: #000000; /* Pure black for maximum contrast */
            font-weight: bold; /* Make all text bold by default */
        }
        
        .receipt-container {
            max-width: 320px; /* Standard thermal paper width (80mm â‰ˆ 320px at 96 DPI) */
            width: 100%;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            border: 1px solid #ddd;
            color: #000000; /* Ensure black text throughout */
        }
        
        /* Font A - Large/Bold for headers and totals */
        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #000000; /* Thicker black border */
        }
        
        .receipt-header img {
            max-width: 60px;
            margin-bottom: 8px;
        }
        
        .receipt-header h2 {
            font-size: 16px; /* Larger font for better visibility */
            font-weight: 900; /* Extra bold */
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #000000;
        }
        
        .receipt-header p {
            margin-bottom: 2px;
            font-size: 11px; /* Slightly larger */
            font-weight: bold; /* Make header info bold */
            color: #000000;
        }
        
        /* Font B - Small/Compact but bold for details */
        .receipt-info {
            margin-bottom: 15px;
            border-bottom: 2px solid #000000; /* Thicker border */
            padding-bottom: 8px;
        }
        
        .receipt-info p {
            margin-bottom: 3px;
            font-size: 11px; /* Slightly larger for visibility */
            font-weight: bold; /* Bold for receipt info */
            color: #000000;
        }
        
        .receipt-info strong {
            font-weight: 900; /* Extra bold for labels */
        }
        
        /* Thermal receipt table with bold text */
        .receipt-table {
            width: 100%;
            margin-bottom: 15px;
            font-size: 11px; /* Slightly larger */
            border-collapse: collapse;
            font-weight: bold; /* Bold table text */
            color: #000000;
        }
        
        .receipt-table th, .receipt-table td {
            padding: 3px 0; /* Slightly more padding */
            vertical-align: top;
            color: #000000;
        }
        
        .receipt-table th {
            text-align: left;
            border-bottom: 2px solid #000000; /* Thicker border */
            font-weight: 900; /* Extra bold headers */
            font-size: 11px;
        }
        
        .receipt-table td {
            font-weight: bold; /* Bold table data */
        }
        
        .receipt-table td.quantity {
            text-align: center;
            width: 15%;
            font-weight: bold;
        }
        
        .receipt-table td.amount {
            text-align: right;
            width: 25%;
            font-weight: bold;
        }
        
        .receipt-table td:first-child {
            width: 35%;
            word-wrap: break-word;
            font-weight: bold;
        }
        
        /* Font A for totals - Extra Bold and larger */
        .receipt-totals {
            margin-top: 10px;
            border-top: 2px solid #000000; /* Thicker border */
            padding-top: 8px;
        }
        
        .receipt-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px; /* Slightly more space */
            font-size: 11px; /* Larger font */
            font-weight: bold; /* Bold totals */
            color: #000000;
        }
        
        .receipt-total-row.final {
            font-weight: 900; /* Extra bold final total */
            font-size: 14px; /* Larger final total */
            margin-top: 8px;
            padding-top: 8px;
            border-top: 3px double #000000; /* Double border for emphasis */
            text-transform: uppercase;
            color: #000000;
        }
        
        /* OCR-B style barcode section - Bold */
        .receipt-barcode {
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            font-family: 'OCR-B', 'Courier New', monospace;
            letter-spacing: 3px;
            font-weight: 900; /* Extra bold barcode */
            color: #000000;
        }
        
        /* Font B for footer - Bold */
        .receipt-footer {
            text-align: center;
            margin-top: 15px;
            padding-top: 8px;
            border-top: 2px solid #000000; /* Thicker border */
            font-size: 10px; /* Slightly larger footer */
            font-weight: bold; /* Bold footer */
            color: #000000;
        }
        
        .receipt-footer p {
            margin-bottom: 3px;
            line-height: 1.1;
            color: #000000;
        }
        
        /* Action buttons - not for thermal printing */
        .receipt-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Thermal Receipt Font Classes - Enhanced for visibility */
        .font-a {
            font-size: 14px;
            font-weight: 900; /* Extra bold */
            color: #000000;
        }
        
        .font-b {
            font-size: 11px;
            font-weight: bold; /* Bold instead of normal */
            color: #000000;
        }
        
        .font-small {
            font-size: 10px;
            font-weight: bold; /* Bold for visibility */
            color: #000000;
        }
        
        /* Double width/height effects for thermal printers */
        .double-width {
            transform: scaleX(2);
            transform-origin: left;
            font-weight: 900; /* Extra bold for scaled text */
        }
        
        .double-height {
            transform: scaleY(2);
            transform-origin: top;
            font-weight: 900; /* Extra bold for scaled text */
        }
        
        .double-size {
            transform: scale(2);
            transform-origin: top left;
            font-weight: 900; /* Extra bold for scaled text */
        }
        
        /* Print styles for actual thermal printing - Maximum contrast */
        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
                color: #000000 !important;
                font-weight: bold !important;
            }
            
            .receipt-container {
                box-shadow: none;
                padding: 5px;
                margin: 0;
                border: none;
                max-width: 100%;
                width: 80mm; /* Actual thermal paper width */
            }
            
            .receipt-actions {
                display: none !important;
            }
            
            /* Ensure maximum contrast for thermal printing */
            *, *:before, *:after {
                color: #000000 !important;
                background-color: white !important;
                font-weight: bold !important;
                text-shadow: none !important;
                box-shadow: none !important;
            }
            
            /* Extra bold for important elements */
            .receipt-header h2,
            .receipt-total-row.final,
            .receipt-barcode {
                font-weight: 900 !important;
            }
            
            /* Thicker borders for print */
            .receipt-header,
            .receipt-info,
            .receipt-totals,
            .receipt-footer {
                border-color: #000000 !important;
                border-width: 2px !important;
            }
            
            .receipt-table th {
                border-bottom: 2px solid #000000 !important;
            }
            
            .receipt-total-row.final {
                border-top: 3px double #000000 !important;
            }
            
            /* Optimize spacing for thermal printing */
            .receipt-header,
            .receipt-info,
            .receipt-totals,
            .receipt-footer {
                margin-bottom: 8px;
                padding-bottom: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="receipt-container">
        <div class="receipt-header">
            {% if business.logo %}
                <img src="{{ business.logo.url }}" alt="{{ business.name }}">
            {% endif %}
            <h2 class="font-a">{{ business.name }}</h2>
            <p class="font-b">{{ business.address }}</p>
            <p class="font-b">Tel: {{ business.phone }}</p>
            <p class="font-b">Email: {{ business.email }}</p>
        </div>
        
        <div class="receipt-info">
            <p class="font-b"><strong>Receipt #:</strong> {{ sale.invoice_number }}</p>
            <p class="font-b"><strong>Date:</strong> {{ sale.created_at|date:"M d, Y H:i" }}</p>
            <p class="font-b"><strong>Customer:</strong> {{ sale.customer.full_name|default:"Walk-in Customer" }}</p>
            {% if sale.employee %}
                <p class="font-b"><strong>Served by:</strong> {{ sale.employee.user.get_full_name }}</p>
            {% endif %}
        </div>
        
        <table class="receipt-table">
            <thead>
                <tr>
                    <th class="font-b">Item</th>
                    <th class="font-b quantity">Qty</th>
                    <th class="font-b amount">Price</th>
                    <th class="font-b amount">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                    <tr class="font-b">
                        <td>{{ item.product.name }}</td>
                        <td class="quantity">{{ item.quantity }}</td>
                        <td class="amount">{{ business.currency_symbol }} {{ item.unit_price|floatformat:2 }}</td>
                        <td class="amount">{{ business.currency_symbol }} {{ item.subtotal|floatformat:2 }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="receipt-totals">
            <div class="receipt-total-row">
                <span>Subtotal:</span>
                <span>{{ business.currency_symbol }} {{ sale.subtotal|floatformat:2 }}</span>
            </div>
            
            {% if sale.tax_amount > 0 %}
                <div class="receipt-total-row">
                    <span>Tax ({{ business.settings.tax_rate }}%):</span>
                    <span>{{ business.currency_symbol }} {{ sale.tax_amount|floatformat:2 }}</span>
                </div>
            {% endif %}
            
            {% if sale.discount_amount > 0 %}
                <div class="receipt-total-row">
                    <span>Discount:</span>
                    <span>{{ business.currency_symbol }} {{ sale.discount_amount|floatformat:2 }}</span>
                </div>
            {% endif %}
            
            <div class="receipt-total-row final">
                <span>Total:</span>
                <span>{{ business.currency_symbol }} {{ sale.total_amount|floatformat:2 }}</span>
            </div>
            
            <div class="receipt-total-row">
                <span>Payment Method:</span>
                <span>{{ sale.get_payment_method_display }}</span>
            </div>
            
            {% if sale.payment_reference %}
                <div class="receipt-total-row">
                    <span>Reference:</span>
                    <span>{{ sale.payment_reference }}</span>
                </div>
            {% endif %}
            
            {% if sale.loyalty_points_earned > 0 or sale.loyalty_points_used > 0 %}
                <div class="receipt-total-row">
                    <span>Loyalty Points Earned:</span>
                    <span>{{ sale.loyalty_points_earned }}</span>
                </div>
                
                {% if sale.loyalty_points_used > 0 %}
                    <div class="receipt-total-row">
                        <span>Loyalty Points Used:</span>
                        <span>{{ sale.loyalty_points_used }}</span>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        
        <div class="receipt-barcode">
            *{{ sale.invoice_number }}*
        </div>
        
        <div class="receipt-footer">
            <p>{{ business.settings.receipt_footer_text|default:"Thank you for your purchase!" }}</p>
            <p>{{ business.settings.return_policy|default:"" }}</p>
        </div>
        
        <div class="receipt-actions">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-print me-1"></i> Print
            </button>
            <a href="{% url 'pos:pos' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to POS
            </a>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>